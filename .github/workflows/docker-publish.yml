permissions:
  contents: read          # still needed
  packages: write         # but we’ll log in with PAT, not GITHUB_TOKEN

steps:
- uses: actions/checkout@v4

- uses: docker/login-action@v3        # <‑‑ Login with the PAT
  with:
    registry: ghcr.io
    username: ${{ github.repository_owner }}
    password: ${{ secrets.GHCR_PAT }}

- uses: docker/setup-buildx-action@v3

- uses: docker/build-push-action@v5
  with:
    context: .
    push: true
    provenance: false                 # <‑‑ TEMP: turn off attestations
    tags: |
      ghcr.io/${{ github.repository_owner }}/woolworths_loyalty_points:latest
      ghcr.io/${{ github.repository_owner }}/woolworths_loyalty_points:${{ github.sha }}
    labels: |
      org.opencontainers.image.source=https://github.com/${{ github.repository }}
      org.opencontainers.image.revision=${{ github.sha }}

